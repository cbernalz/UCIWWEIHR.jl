```@setup tutorial
using Plots, StatsPlots; gr()
Plots.reset_defaults()

```

# [Generating Posterior Distribution Samples with UCIWWEIHR ODE Compartmental Based Model without Forecasting.](@id uciwwiehr_model_fitting_no_forecast)

This package has a way to sample from a posterior or prior that is defined in the future paper using the `uciwweihr_fit.jl` and `uciwweihr_model.jl`.  We can then generate desired quantities and forecast for a given time period with the posterior predictive distribution, using `uciwweihr_gq_pp.jl`.  We first generate data using the `generate_simulation_data_uciwweihr` function which is a non-mispecified version of the model, we will also be using prespecified effective reporduction curves and prespecified hospitalization probability curves.


## 1. Data Generation.

``` @example tutorial
using UCIWWEIHR
# Running simulation function with presets
rt_custom = vcat(
    range(1, stop=1.8, length=7*4),
    fill(1.8, 7*2),
    range(1.8, stop=1, length=7*8),
    range(0.98, stop=0.8, length=7*2),
    range(0.8, stop=1.1, length=7*6),
    range(1.1, stop=0.97, length=7*3)
)
w_custom = vcat(
    range(0.3, stop=0.38, length=7*5),
    fill(0.38, 7*2),
    range(0.38, stop=0.25, length=7*8),
    range(0.25, stop=0.28, length=7*2),
    range(0.28, stop=0.34, length=7*6),
    range(0.34, stop=0.28, length=7*2)
)
params = create_uciwweihr_params(
    time_points = length(rt_custom),
    Rt = rt_custom, 
    w = w_custom
)
df = generate_simulation_data_uciwweihr(params)
first(df, 5)
```

## 2. Sampling from the Posterior Distribution and Posterior Predictive Distribution.

Here we sample from the posterior distribution using the `uciwweihr_fit.jl` function.  First, we setup some presets, then have an array where index 1 contains the posterior/prior predictive samples, index 2 contains the posterior/prior generated quantities samples, and index 3 contains the original sampled parameters for the model.

``` @example tutorial
data_hosp = df.hosp
data_wastewater = df.log_ww_conc
obstimes = df.obstimes
param_change_times = 1:7:length(obstimes) # Change every week
priors_only = false
n_samples = 50

samples = uciwweihr_fit(
    data_hosp,
    data_wastewater,
    obstimes,
    param_change_times,
    priors_only,
    n_samples
)
model_output = uciwweihr_gq_pp(
    samples = samples,
    data_hosp = data_hosp,
    data_wastewater = data_wastewater,
    obstimes = obstimes,
    param_change_times = param_change_times,
)

first(model_output[1][:,1:5], 5)
```

``` @example tutorial
first(model_output[2][:,1:5], 5)
```

``` @example tutorial
first(model_output[3][:,1:5], 5)
```

## 3. MCMC Diagnostic Plots/Results Along with Posterior Predictive Distribution.

We also provide a very basic way to visualize some MCMC diagnostics along with effective sample sizes of desired generated quantities(does not include functionality for time-varying quantities).  Along with this, we can also visualize the posterior predictive distribution with actual observed values, which can be used to examine forecasts generated by the model.

```@example tutorial
uciwweihr_visualizer(
    pp_samples = model_output[1],
    gq_samples = model_output[2],
    data_hosp = data_hosp,
    data_wastewater = data_wastewater, 
    actual_rt_vals = df.rt, 
    actual_w_t = df.wt, 
    actual_non_time_varying_vals = params,
    bayes_dist_type = "Posterior",
    save_plots = true
)
```

### 3.1. MCMC Diagnostic Plots.

![Plot 1](plots/mcmc_diagnosis_plots.png)

### 3.2. Time Varying Parameter Results Plot.

![Plot 2](plots/mcmc_time_varying_parameter_plots.png)

### 3.3. Non-Time Varying Parameter Results Plot.
![Plot 3](plots/mcmc_nontime_varying_parameter_plots.png)

### 3.4. Posterior Predictive Distribution Plot.

![Plot 4](plots/mcmc_pred_parameter_plots.png)


### [Tutorial Contents](@ref tutorial_home)