```@setup tutorial
using Plots, StatsPlots; gr()
Plots.reset_defaults()

```

# [Generating Posterior Distribution Samples with UCIWWEIHR ODE compartmental based model.](@id uciwwiehr_model_fitting)

This package has a way to sample from a posterior or prior that is defined in the future paper using the `uciwweihr_fit.jl` and `uciwweihr_model.jl`.  We can then generate desired quantities and forecast for a given time period with the posterior predictive distribution, using `uciwweihr_gq_pp.jl`.  We first generate data using the `generate_simulation_data_uciwweihr` function which is a non-mispecified version of the model.


## 1. Data Generation.

``` @example tutorial
using UCIWWEIHR
# Running simulation function with defaults
df = generate_simulation_data_uciwweihr()
first(df, 5)
```

## 2. Sampling from the Posterior Distribution and Posterior Predictive Distribution.

Here we sample from the posterior distribution using the `uciwweihr_fit.jl` function.  First, we setup some presets, then have an array where index 1 contains the posterior/prior predictive samples, index 2 contains the posterior/prior generated quantities samples, and index 3 contains the original sampled parameters for the model.

``` @example tutorial
data_hosp = df.hosp
data_wastewater = df.log_ww_conc
obstimes = df.obstimes
param_change_times = 1:7:length(obstimes) # Change every week
priors_only = false
n_samples = 50

samples = uciwweihr_fit(
    data_hosp,
    data_wastewater,
    obstimes,
    param_change_times,
    priors_only,
    n_samples
)
model_output = uciwweihr_gq_pp(
    samples,
    data_hosp,
    data_wastewater,
    obstimes,
    param_change_times
)

first(model_output[1][:,1:5], 5)
```

``` @example tutorial
first(model_output[2][:,1:5], 5)
```

``` @example tutorial
first(model_output[3][:,1:5], 5)
```

## 3. MCMC Diagnostic Plots/Results Along with Posterior Predictive Distribution.

We also provide a very basic way to visualize some MCMC diagnostics along with effective sample sizes of desired generated quantities(does not include functionality for time-varying quantities).  Along with this, we can also visualize the posterior predictive distribution with actual observed values, which can be used to examine forecasts generated by the model.

```@example tutorial
uciwweihr_visualizer(gq_samples = model_output[2], 
                        actual_rt_vals = df.rt, 
                        actual_w_t = df.wt, 
                        save_plots = true)
```

### 3.1. MCMC Diagnostic Plots.

![Plot 1](plots/mcmc_diagnosis_plots.png)

### 3.2. Time Varying Parameter Results Plot.

![Plot 2](plots/mcmc_time_varying_parameter_plots.png)


### [Tutorial Contents](@ref tutorial_home)